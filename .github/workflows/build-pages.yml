# .github/workflows/build-pages.yml
name: Docs Hub → GitHub Pages
on:
  workflow_dispatch:      # run manually
  schedule:
    - cron: '17 3 * * *'  # nightly

permissions:
  contents: read
  pages:    write          # required by deploy-pages
  id-token: write          # required by deploy-pages
  actions:  read           # lets deploy-pages read the build’s artifacts

env:
  PY_VER: "3.11"
  # <name> <ref> <url>  — add as many as you like
  LIBRARIES: |
    shapelearn dev https://github.com/ByteShape/ShapeLearn.git

###############################################################################
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - uses: actions/setup-python@v5
      with:
        python-version: ${{ env.PY_VER }}

    # ---------------------------------------------
    # (your loop that clones → builds HTML into site/)
    # ---------------------------------------------
    - name: Example static page
      run: |
        rm -rf site && mkdir site
        echo '<h1>Hello Pages</h1>' > site/index.html

    # 1️⃣ MUST run before uploading
    - uses: actions/configure-pages@v3

    # 2️⃣ MUST upload an artifact **named "github-pages"**
    - uses: actions/upload-pages-artifact@v2
      with:
        path: site              # folder to publish
        name: github-pages      # DO NOT change this

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages       # Pages creates this on first success
    permissions:
      pages: write
      id-token: write
      actions: read
    steps:
    # 3️⃣ publishes the artifact produced in the same run
    - id: deployment
      uses: actions/deploy-pages@v2
      with:
        artifact_name: github-pages   # must match upload step
